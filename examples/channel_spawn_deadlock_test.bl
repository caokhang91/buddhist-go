// Channel Spawn Deadlock Test - Demonstrates the deadlock issue from terminal
// This shows what NOT to do - using ch < value (comparison) instead of ch <- value (send)

println("=== Channel Spawn Deadlock Test ===");

// HTTP Request configuration
let getConfig = {
    "method": "GET",
    "url": "https://httpbin.org/get",
    "params": {"q": "buddhist-go", "page": 1},
    "headers": {"User-Agent": "buddhist-go"}
};

// Create a channel
let ch = channel;

println("Testing WRONG syntax (will deadlock):");
println("ch < http_request(getConfig) is parsed as a comparison, not a send!");

// WRONG SYNTAX - This causes deadlock!
// spawn fn() { ch < http_request(getConfig); };  // Parsed as comparison, not send
// let resp = < ch;  // Waits forever because nothing was sent

println("\n=== Correct Syntax Example ===");
println("Use ch <- value for sending, not ch < value");

// CORRECT SYNTAX - This works:
let ch2 = channel;
spawn fn() {
    let response = http_request(getConfig);
    ch2 <- response;  // Correct: <- operator for channel send
};

let resp = <- ch2;  // Correct: <- operator for channel receive
println("Received response!");
println("Response type: " + type(resp));
if (type(resp) == "HASH") {
    println("Status: " + str(resp["status"]));
} else {
    println("Got: " + type(resp));
}

println("\n=== Summary ===");
println("WRONG: ch < value  (parsed as comparison)");
println("CORRECT: ch <- value (channel send)");
println("CORRECT: <- ch or < ch (channel receive - both work)");
